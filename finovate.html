<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finovate - Personal Finance Manager</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Login Container Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
        }

        .login-container.show {
            opacity: 1;
            transform: scale(1);
        }

        .login-form {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-form h1 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            margin-bottom: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .app-container {
            display: none;
            min-height: 100vh;
            background: #f8fafc;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 30px 0;
            z-index: 1000;
        }

        .logo {
            text-align: center;
            margin-bottom: 40px;
            padding: 0 30px;
        }

        .logo h2 {
            color: #667eea;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 30px;
            color: #64748b;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-link:hover, .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .nav-link span {
            margin-left: 12px;
        }

        .main-content {
            margin-left: 280px;
            padding: 30px;
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .welcome-text {
            flex-grow: 1;
        }

        .welcome-text h1 {
            color: #1e293b;
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .welcome-text p {
            color: #64748b;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-value.positive { color: #10b981; }
        .stat-value.negative { color: #ef4444; }
        .stat-value.neutral { color: #667eea; }

        .stat-label {
            color: #64748b;
            font-weight: 500;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .content-section.active {
            display: block;
        }

        .section-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-control {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
        }

        .transactions-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .transaction-info h4 {
            color: #1e293b;
            margin-bottom: 5px;
        }

        .transaction-info p {
            color: #64748b;
            font-size: 14px;
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .transaction-amount.income { color: #10b981; }
        .transaction-amount.expense { color: #ef4444; }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            margin-top: 20px;
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e2e8f0;
        }

        .chart-canvas {
            width: 100% !important;
            height: 100% !important;
            max-width: 100%;
            max-height: 100%;
        }

        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .goal-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .goal-progress {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .goal-progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        .mobile-menu-btn {
            display: none;
            background: #667eea;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
        }

        .sidebar.mobile-open {
            transform: translateX(0);
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .chart-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            color: #64748b;
            font-size: 16px;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }

            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
                z-index: 1001;
            }
            
            .main-content {
                margin-left: 0;
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .user-info {
                width: 100%;
                justify-content: space-between;
            }

            .chart-container {
                height: 300px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-container">
        <div class="login-form">
            <h1>Finovate</h1>
            <div id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">Email</label> <input type="email" id="loginUsername" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password">
                </div>
                <button class="btn" onclick="login()">Sign In</button>
                <button class="btn btn-secondary" onclick="showSignup()">Create Account</button>
            </div>
            
            <div id="signupForm" style="display: none;">
                <div class="form-group">
                    <label for="signupUsername">Username</label>
                    <input type="text" id="signupUsername" placeholder="Choose a username">
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" placeholder="Choose a password">
                </div>
                <button class="btn" onclick="signup()">Create Account</button>
                <button class="btn btn-secondary" onclick="showLogin()">Back to Sign In</button>
            </div>
        </div>
    </div>

    <div id="appContainer" class="app-container">
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileMenu()"></div>
        
        <nav class="sidebar" id="sidebar">
            <div class="logo">
                <h2>Finovate</h2>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" onclick="showSection('dashboard', event)">
                        <span>ðŸ“Š</span><span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('transactions', event)">
                        <span>ðŸ’³</span><span>Transactions</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('budgets', event)">
                        <span>ðŸ“ˆ</span><span>Budgets</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('goals', event)">
                        <span>ðŸŽ¯</span><span>Goals</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('reports', event)">
                        <span>ðŸ“‹</span><span>Reports</span>
                    </a>
                </li>
            </ul>
        </nav>

        <main class="main-content">
            <header class="header">
                <div class="welcome-text">
                    <h1>Welcome back, <span id="currentUser">User</span>!</h1>
                    <p>Here's your financial overview</p>
                </div>
                <div class="user-info">
                    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </header>

            <section id="dashboard" class="content-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value neutral" id="totalBalance">$0.00</div>
                        <div class="stat-label">Total Balance</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value positive" id="totalIncome">$0.00</div>
                        <div class="stat-label">Total Income</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value negative" id="totalExpenses">$0.00</div>
                        <div class="stat-label">Total Expenses</div>
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title">Add Income</h2>
                    <p style="color: #64748b; margin-bottom: 15px;">Add income to increase your balance. Expenses will automatically reduce your balance.</p>
                    <div class="form-row">
                        <input type="number" id="incomeAmount" class="form-control" placeholder="Income Amount" step="0.01">
                        <input type="text" id="incomeSource" class="form-control" placeholder="Income Source (e.g., Salary, Freelance, Gift)">
                    </div>
                    <button class="btn-primary" onclick="addIncome()">Add Income</button>
                </div>

                <div class="section-card">
                    <h2 class="section-title">Quick Add Transaction</h2>
                    <div class="form-row">
                        <input type="text" id="quickDescription" class="form-control" placeholder="Description">
                        <input type="number" id="quickAmount" class="form-control" placeholder="Amount" step="0.01">
                        <select id="quickType" class="form-control">
                            <option value="income">Income</option>
                            <option value="expense">Expense</option>
                        </select>
                        <select id="quickCategory" class="form-control">
                            <option value="Food">Food</option>
                            <option value="Transportation">Transportation</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Bills">Bills</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Salary">Salary</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <button class="btn-primary" onclick="addQuickTransaction()">Add Transaction</button>
                </div>

                <div class="section-card">
                    <h2 class="section-title">Recent Transactions</h2>
                    <div id="recentTransactions" class="transactions-list">
                        </div>
                </div>
            </section>

            <section id="transactions" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">All Transactions</h2>
                    <div id="allTransactions" class="transactions-list">
                        </div>
                </div>
            </section>

            <section id="budgets" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">Monthly Budgets</h2>
                    <div class="form-row">
                        <select id="budgetCategory" class="form-control">
                            <option value="Food">Food</option>
                            <option value="Transportation">Transportation</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Bills">Bills</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Other">Other</option>
                        </select>
                        <input type="number" id="budgetAmount" class="form-control" placeholder="Budget Amount" step="0.01">
                    </div>
                    <button class="btn-primary" onclick="addBudget()">Set Budget</button>
                    <div id="budgetsList" style="margin-top: 20px;">
                        </div>
                </div>
            </section>

            <section id="goals" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">Savings Goals</h2>
                    <div class="form-row">
                        <input type="text" id="goalName" class="form-control" placeholder="Goal Name">
                        <input type="number" id="goalAmount" class="form-control" placeholder="Target Amount" step="0.01">
                        <input type="date" id="goalDeadline" class="form-control">
                    </div>
                    <button class="btn-primary" onclick="addGoal()">Create Goal</button>
                </div>
                <div id="goalsList" class="goals-grid">
                    </div>
            </section>

            <section id="reports" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">Expense Categories</h2>
                    <div class="chart-container">
                        <canvas id="expenseChart" class="chart-canvas"></canvas>
                    </div>
                </div>
                <div class="section-card">
                    <h2 class="section-title">Income vs Expenses Over Time</h2>
                    <div class="chart-container">
                        <canvas id="incomeExpenseChart" class="chart-canvas"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // --- START: Firebase Configuration and Initialization ---
        // ðŸš¨ IMPORTANT: Paste your Firebase config object here from your Firebase console
        // Example: const firebaseConfig = { ... };
        //
        // Your code will look like this:
        const firebaseConfig = {
            apiKey: "AIzaSyAPKSG6ckg4UZlvn3d7rHXIs6_rKBF-EF0",
            authDomain: "financeapp-a44ab.firebaseapp.com",
            projectId: "financeapp-a44ab",
            storageBucket: "financeapp-a44ab.firebasestorage.app",
            messagingSenderId: "978066836645",
            appId: "1:978066836645:web:7e441482170dc0bb7ed14c",
            measurementId: "G-0FY2NY3NWN"
        };
        
        let auth, db;
        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            console.log("Firebase initialized successfully.");
        } catch (e) {
            console.error("Firebase initialization failed.", e);
            alert("Warning: Firebase is not configured correctly. The app will not save data across devices. Please check the console for errors.");
            
            document.addEventListener('DOMContentLoaded', () => {
                document.getElementById('loginScreen').classList.add('show');
            });
        }
        // --- END: Firebase Configuration and Initialization ---

        // Global variables (now stored in memory, synced with Firestore)
        let currentUser = null;
        let transactions = [];
        let budgets = [];
        let goals = [];
        let expenseChart = null;
        let incomeExpenseChart = null;
        
        // This is the correct entry point for the app
        document.addEventListener('DOMContentLoaded', function() {
            if (auth && db) { // Check if Firebase initialized successfully
                auth.onAuthStateChanged(user => {
                    if (user) {
                        // User is signed in.
                        currentUser = user.email;
                        showApp();
                    } else {
                        // User is signed out.
                        showLogin();
                    }
                });
            } else {
                // If Firebase failed to initialize, show login screen without auth logic
                document.getElementById('loginScreen').classList.add('show');
            }
        });

        // Authentication functions
        function showSignup() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'block';
        }

        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('loginScreen').classList.add('show');
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('signupForm').style.display = 'none';
        }
        
        // NEW: Signup with Firebase
        function signup() {
            const username = document.getElementById('signupUsername').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
        
            if (!username || !email || !password) {
                alert('Please fill in all fields');
                return;
            }
        
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    // Add the username to the user's Firestore document
                    db.collection('users').doc(user.uid).set({
                        email: user.email,
                        username: username,
                        transactions: [],
                        budgets: [],
                        goals: []
                    }).then(() => {
                        alert('Account created successfully!');
                        showLogin();
                    });
                })
                .catch((error) => {
                    alert(error.message);
                });
        }
        
        // NEW: Login with Firebase
        function login() {
            const email = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
        
            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }
        
            auth.signInWithEmailAndPassword(email, password)
                .catch((error) => {
                    alert(error.message);
                });
        }
        
        // NEW: Logout with Firebase
        function logout() {
            auth.signOut()
                .then(() => {
                    // Sign-out successful. The auth state listener will handle showing the login page.
                    console.log('User signed out successfully.');
                })
                .catch((error) => {
                    alert('Error signing out: ' + error.message);
                });
        }

        // --- CORRECTED: showApp() to use username from Firestore ---
        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('loginScreen').classList.remove('show');
            document.getElementById('appContainer').style.display = 'block';

            // Fetch the username from Firestore to display
            if (auth.currentUser) {
                const userId = auth.currentUser.uid;
                db.collection('users').doc(userId).get().then(doc => {
                    if (doc.exists) {
                        document.getElementById('currentUser').textContent = doc.data().username;
                    } else {
                        document.getElementById('currentUser').textContent = 'User';
                    }
                }).catch(error => {
                    console.error("Error fetching username:", error);
                    document.getElementById('currentUser').textContent = 'User';
                });
            } else {
                document.getElementById('currentUser').textContent = 'User';
            }

            loadUserData();
            
            setTimeout(() => {
                initializeCharts();
            }, 100);
        }

        // --- Start: Data Management Functions with Firestore ---

        // NEW: Load data from Firestore
        function loadUserData() {
            if (!auth.currentUser) return;
            const userId = auth.currentUser.uid;
            
            db.collection('users').doc(userId).get().then((doc) => {
                if (doc.exists) {
                    const userData = doc.data();
                    transactions = userData.transactions || [];
                    budgets = userData.budgets || [];
                    goals = userData.goals || [];
                } else {
                    transactions = [];
                    budgets = [];
                    goals = [];
                }
                updateDashboard();
                updateTransactionsList();
                updateBudgetsList();
                updateGoalsList();
                refreshCharts();
            }).catch((error) => {
                console.error("Error getting user data:", error);
                alert("Failed to load user data. Please try again.");
            });
        }

        // NEW: Save data to Firestore
        function saveUserData() {
            if (!auth.currentUser) return;
            const userId = auth.currentUser.uid;

            db.collection('users').doc(userId).set({
                transactions: transactions,
                budgets: budgets,
                goals: goals
            }, { merge: true })
            .then(() => {
                console.log("Data successfully saved to Firestore!");
            })
            .catch((error) => {
                console.error("Error writing document:", error);
                alert("Failed to save data. Please check your connection.");
            });
        }

        // --- End: Data Management Functions with Firestore ---


        // --- Your original functions are updated to call saveUserData() ---
        function addQuickTransaction() {
            const description = document.getElementById('quickDescription').value;
            const amount = parseFloat(document.getElementById('quickAmount').value);
            const type = document.getElementById('quickType').value;
            const category = document.getElementById('quickCategory').value;

            if (!description || !amount) {
                alert('Please fill in description and amount');
                return;
            }

            const transaction = {
                id: Date.now(),
                description: description,
                amount: amount,
                type: type,
                category: category,
                date: new Date().toISOString().split('T')[0]
            };

            transactions.unshift(transaction);
            saveUserData();
            updateDashboard();
            updateTransactionsList();
            refreshCharts();

            document.getElementById('quickDescription').value = '';
            document.getElementById('quickAmount').value = '';
        }

        function deleteTransaction(id) {
            if (confirm("Are you sure you want to delete this transaction?")) {
                transactions = transactions.filter(t => t.id !== id);
                saveUserData();
                updateDashboard();
                updateTransactionsList();
                refreshCharts();
            }
        }

        function addBudget() {
            const category = document.getElementById('budgetCategory').value;
            const amount = parseFloat(document.getElementById('budgetAmount').value);

            if (!amount) {
                alert('Please enter budget amount');
                return;
            }

            budgets = budgets.filter(b => b.category !== category);

            const budget = {
                id: Date.now(),
                category: category,
                amount: amount,
                month: new Date().getMonth(),
                year: new Date().getFullYear()
            };

            budgets.push(budget);
            saveUserData();
            updateBudgetsList();

            document.getElementById('budgetAmount').value = '';
        }

        function deleteBudget(id) {
            if (confirm("Are you sure you want to delete this budget?")) {
                budgets = budgets.filter(b => b.id !== id);
                saveUserData();
                updateBudgetsList();
            }
        }

        function addGoal() {
            const name = document.getElementById('goalName').value;
            const amount = parseFloat(document.getElementById('goalAmount').value);
            const deadline = document.getElementById('goalDeadline').value;

            if (!name || !amount || !deadline) {
                alert('Please fill in all goal fields');
                return;
            }

            const goal = {
                id: Date.now(),
                name: name,
                targetAmount: amount,
                currentAmount: 0,
                deadline: deadline,
                createdAt: new Date().toISOString()
            };

            goals.push(goal);
            saveUserData();
            updateGoalsList();

            document.getElementById('goalName').value = '';
            document.getElementById('goalAmount').value = '';
            document.getElementById('goalDeadline').value = '';
        }

        function deleteGoal(id) {
            if (confirm("Are you sure you want to delete this goal?")) {
                goals = goals.filter(g => g.id !== id);
                saveUserData();
                updateGoalsList();
            }
        }

        function addToGoal(id, amount) {
            const goal = goals.find(g => g.id === id);
            if (goal) {
                goal.currentAmount += amount;
                saveUserData();
                updateGoalsList();
            }
        }

        function addIncome() {
            const amount = parseFloat(document.getElementById('incomeAmount').value);
            const source = document.getElementById('incomeSource').value;

            if (!amount || amount <= 0) {
                alert('Please enter a valid income amount');
                return;
            }

            if (!source) {
                alert('Please specify the income source');
                return;
            }

            const transaction = {
                id: Date.now(),
                description: source,
                amount: amount,
                type: 'income',
                category: 'Income',
                date: new Date().toISOString().split('T')[0]
            };

            transactions.unshift(transaction);
            saveUserData();
            updateDashboard();
            updateTransactionsList();
            refreshCharts();

            document.getElementById('incomeAmount').value = '';
            document.getElementById('incomeSource').value = '';

            alert(`Income of $${amount.toFixed(2)} added successfully!`);
        }

        function updateDashboard() {
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);

            const totalExpenses = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            const balance = totalIncome - totalExpenses;

            document.getElementById('totalBalance').textContent = `$${balance.toFixed(2)}`;
            document.getElementById('totalIncome').textContent = `$${totalIncome.toFixed(2)}`;
            document.getElementById('totalExpenses').textContent = `$${totalExpenses.toFixed(2)}`;

            updateRecentTransactions();
        }

        function updateRecentTransactions() {
            const recentContainer = document.getElementById('recentTransactions');
            const recent = transactions.slice(0, 5);

            if (recent.length === 0) {
                recentContainer.innerHTML = '<p style="text-align: center; color: #64748b; padding: 20px;">No transactions yet. Add your first transaction above!</p>';
                return;
            }

            recentContainer.innerHTML = recent.map(transaction => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <h4>${transaction.description}</h4>
                        <p>${transaction.category} â€¢ ${transaction.date}</p>
                    </div>
                    <div class="transaction-amount ${transaction.type}">
                        ${transaction.type === 'income' ? '+' : '-'}$${transaction.amount.toFixed(2)}
                        <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function updateTransactionsList() {
            const container = document.getElementById('allTransactions');
            
            if (transactions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #64748b; padding: 20px;">No transactions yet.</p>';
                return;
            }

            container.innerHTML = transactions.map(transaction => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <h4>${transaction.description}</h4>
                        <p>${transaction.category} â€¢ ${transaction.date}</p>
                    </div>
                    <div class="transaction-amount ${transaction.type}">
                        ${transaction.type === 'income' ? '+' : '-'}$${transaction.amount.toFixed(2)}
                        <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function updateBudgetsList() {
            const container = document.getElementById('budgetsList');
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            if (budgets.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #64748b; padding: 20px;">No budgets set yet.</p>';
                return;
            }

            container.innerHTML = budgets.map(budget => {
                const spent = transactions
                    .filter(t => t.type === 'expense' && t.category === budget.category)
                    .reduce((sum, t) => sum + t.amount, 0);

                const percentage = (spent / budget.amount) * 100;
                const remaining = budget.amount - spent;

                return `
                    <div class="goal-card">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>${budget.category}</h3>
                            <button class="delete-btn" onclick="deleteBudget(${budget.id})">Delete</button>
                        </div>
                        <p>Budget: $${budget.amount.toFixed(2)} | Spent: $${spent.toFixed(2)} | Remaining: $${remaining.toFixed(2)}</p>
                        <div class="goal-progress">
                            <div class="goal-progress-bar" style="width: ${Math.min(percentage, 100)}%"></div>
                        </div>
                        <p style="font-size: 14px; color: ${percentage > 100 ? '#ef4444' : '#64748b'};">
                            ${percentage.toFixed(1)}% used
                        </p>
                    </div>
                `;
            }).join('');
        }

        function updateGoalsList() {
            const container = document.getElementById('goalsList');

            if (goals.length === 0) {
                container.innerHTML = '<div class="section-card"><p style="text-align: center; color: #64748b;">No goals set yet.</p></div>';
                return;
            }

            container.innerHTML = goals.map(goal => {
                const percentage = (goal.currentAmount / goal.targetAmount) * 100;
                const remaining = goal.targetAmount - goal.currentAmount;

                return `
                    <div class="goal-card">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>${goal.name}</h3>
                            <button class="delete-btn" onclick="deleteGoal(${goal.id})">Delete</button>
                        </div>
                        <p>Target: $${goal.targetAmount.toFixed(2)} | Saved: $${goal.currentAmount.toFixed(2)}</p>
                        <p>Deadline: ${goal.deadline}</p>
                        <div class="goal-progress">
                            <div class="goal-progress-bar" style="width: ${Math.min(percentage, 100)}%"></div>
                        </div>
                        <p style="font-size: 14px; color: #64748b;">${percentage.toFixed(1)}% complete</p>
                        <div style="margin-top: 15px;">
                            <input type="number" id="goalAdd${goal.id}" placeholder="Add amount" step="0.01" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px; margin-right: 10px;">
                            <button class="btn-primary" style="padding: 8px 16px; font-size: 14px;" onclick="addToGoal(${goal.id}, parseFloat(document.getElementById('goalAdd${goal.id}').value) || 0); document.getElementById('goalAdd${goal.id}').value = '';">Add</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function initializeCharts() {
            if (expenseChart) {
                expenseChart.destroy();
                expenseChart = null;
            }
            if (incomeExpenseChart) {
                incomeExpenseChart.destroy();
                incomeExpenseChart = null;
            }
            
            if (document.getElementById('expenseChart')) {
                createExpenseChart();
            }
            if (document.getElementById('incomeExpenseChart')) {
                createIncomeExpenseChart();
            }
        }

        function refreshCharts() {
            if (expenseChart) {
                expenseChart.destroy();
                expenseChart = null;
            }
            if (incomeExpenseChart) {
                incomeExpenseChart.destroy();
                incomeExpenseChart = null;
            }
            
            setTimeout(() => {
                initializeCharts();
            }, 100);
        }

        function createExpenseChart() {
            const canvas = document.getElementById('expenseChart');
            if (!canvas) {
                return;
            }

            const ctx = canvas.getContext('2d');
            const expensesByCategory = {};
            transactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + t.amount;
                });

            let labels = Object.keys(expensesByCategory);
            let data = Object.values(expensesByCategory);

            if (labels.length === 0) {
                labels = ['Food', 'Transportation', 'Entertainment', 'Bills', 'Shopping'];
                data = [450, 280, 150, 600, 320];
            }

            try {
                expenseChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                '#667eea', '#764ba2', '#f093fb', '#f5576c',
                                '#4facfe', '#00f2fe', '#43e97b', '#38f9d7'
                            ],
                            borderWidth: 3,
                            borderColor: '#ffffff',
                            hoverBorderWidth: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    font: {
                                        size: 14,
                                        weight: '500'
                                    }
                                }
                            },
                            tooltip: {
                                enabled: true,
                                backgroundColor: 'rgba(0,0,0,0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#667eea',
                                borderWidth: 1,
                                callbacks: {
                                    label: function(context) {
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        return `${context.label}: $${context.parsed.toFixed(2)} (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        cutout: '60%',
                        animation: {
                            animateRotate: true,
                            duration: 1000
                        }
                    }
                });
            } catch (error) {
                console.error('Error creating expense chart:', error);
            }
        }

        function createIncomeExpenseChart() {
            const canvas = document.getElementById('incomeExpenseChart');
            if (!canvas) {
                return;
            }

            const ctx = canvas.getContext('2d');
            const months = [];
            const incomeData = [];
            const expenseData = [];

            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                const monthYear = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                
                months.push(date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }));
                
                const monthIncome = transactions
                    .filter(t => t.type === 'income' && t.date.startsWith(monthYear))
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthExpense = transactions
                    .filter(t => t.type === 'expense' && t.date.startsWith(monthYear))
                    .reduce((sum, t) => sum + t.amount, 0);
                
                incomeData.push(monthIncome);
                expenseData.push(monthExpense);
            }

            if (incomeData.every(val => val === 0) && expenseData.every(val => val === 0)) {
                const sampleIncome = [2800, 3200, 2900, 3100, 3000, 3300];
                const sampleExpenses = [2200, 2400, 2100, 2600, 2300, 2500];
                incomeData.splice(0, 6, ...sampleIncome);
                expenseData.splice(0, 6, ...sampleExpenses);
            }

            try {
                incomeExpenseChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'Income',
                            data: incomeData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            borderWidth: 4
                        }, {
                            label: 'Expenses',
                            data: expenseData,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#ef4444',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            borderWidth: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    font: {
                                        size: 14,
                                        weight: '500'
                                    }
                                }
                            },
                            tooltip: {
                                enabled: true,
                                backgroundColor: 'rgba(0,0,0,0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#667eea',
                                borderWidth: 1,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: $${context.parsed.y.toFixed(2)}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                display: true,
                                grid: {
                                    display: true,
                                    color: 'rgba(0,0,0,0.1)',
                                    drawBorder: true,
                                    lineWidth: 1
                                },
                                ticks: {
                                    display: true,
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    },
                                    font: {
                                        size: 12
                                    },
                                    color: '#64748b'
                                },
                                title: {
                                    display: true,
                                    text: 'Amount ($)',
                                    font: {
                                        size: 14,
                                        weight: '600'
                                    },
                                    color: '#1e293b'
                                }
                            },
                            x: {
                                display: true,
                                grid: {
                                    display: true,
                                    color: 'rgba(0,0,0,0.1)',
                                    drawBorder: true,
                                    lineWidth: 1
                                },
                                ticks: {
                                    display: true,
                                    font: {
                                        size: 12
                                    },
                                    color: '#64748b'
                                },
                                title: {
                                    display: true,
                                    text: 'Month',
                                    font: {
                                        size: 14,
                                        weight: '600'
                                    },
                                    color: '#1e293b'
                                }
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            } catch (error) {
                console.error('Error creating income expense chart:', error);
            }
        }

        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('mobile-open');
            
            if (sidebar.classList.contains('mobile-open')) {
                overlay.style.display = 'block';
            } else {
                overlay.style.display = 'none';
            }
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.remove('mobile-open');
            overlay.style.display = 'none';
        }
    </script>
</body>
</html>